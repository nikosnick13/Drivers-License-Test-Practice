using Drivers_License_Test_Practice.AnsuerAndQoyestion;
using Drivers_License_Test_Practice.DbContext;
using System;
using System.Collections.Generic;
using System.Data.SqlClient;
using System.Linq;
using System.Reflection.Metadata;
using System.Text;
using System.Threading.Tasks;
using static System.Console;
 

namespace Drivers_License_Test_Practice.UI
{
    internal class UI_Login
    {


        static string? password;
        static string? username;


        private string conecionString;
        public UI_Login()
        {
            conecionString = SQLConnection.GetConnectionString();
        }

        //Εισοδος Χρηστη
        public static void DassboardLogin()
        {
            Utility.Consoleframe();

            Console.Clear();
            Console.WriteLine("\n\r\n\r|================================================== Είσοδος Χρήστη ==================================================|\n\r\n\r");
            //username input
            Console.WriteLine("Ονομα:");

            string? usernameInput = Console.ReadLine();
            username = usernameInput?.ToLower() ?? string.Empty;
            //Password input
            Console.WriteLine("Κωδικός:");

            // string? usernameOutput = Console.ReadLine();
            password = Utility.HidePassword().ToLower() ?? string.Empty; 

            // Έλεγχος για null και παροχή προεπιλεγμένων τιμών
            if (string.IsNullOrEmpty(username) || (string.IsNullOrEmpty(password)))
            {
                Console.WriteLine("Το όνομα χρήστη ή ο κωδικός πρόσβασης είναι λάθος.");
                Utility.PressEnter();
                DassboardLogin();
                return;
            }
            bool isValid = SQLConnection.ValidationLoginUser(username, password);
            //if χωρις else
            if (!isValid)
            {
                WriteLine("\n\r\n\rΛαθος ονομα χρήστη ή κωδικό\n\r\n\r");
                WriteLine("Προσπάθησε ξανά.....");
                Utility.PressEnter();
                Clear();
                DassboardLogin();
                return;
            }   
            WriteLine($"\n\n~~~~ Καλωσόρισες, {username} ~~~~\n");
            Utility.PressEnter();
            Clear();

            Console.WriteLine("\n\r\n\r|==================================================== Ερωτήσεις =====================================================|\n\r\n\r");
            QuestionAnswer newQuestionAnswer = new QuestionAnswer();
            newQuestionAnswer.CreatTable(); 
            GreatAndAddQuestions();
            newQuestionAnswer.PrintQuestionsAddCollectAnswers();
            Utility.PressEnter();
            // TO DO :
            // 

        }
       
        //Ερωτησης 
        public static void GreatAndAddQuestions() 
        {
            QuestionAnswer newQuestionAnswer = new QuestionAnswer();
            newQuestionAnswer.CreatTable();
            

            
            // Προσθήκη 10 ερωτήσεων στη βάση δεδομένων
            // List of questions to add
            var questionsToAdd = new List<(string question, string option1, string option2, string option3, string option4, int correctOption, string category)>
            {
                ("Ποιο είναι το όριο ταχύτητας σε κατοικημένη περιοχή?", "50 χλμ/ώρα", "60 χλμ/ώρα", "70 χλμ/ώρα", "80 χλμ/ώρα", 1, "θεωρητική"),
                ("Ποιο είναι το ελάχιστο όριο ταχύτητας στον αυτοκινητόδρομο;", "50 χλμ/ώρα", "60 χλμ/ώρα", "70 χλμ/ώρα", "80 χλμ/ώρα", 4, "θεωρητική"),
                ("Ποια είναι η προτεραιότητα σε μία διασταύρωση χωρίς σήμανση;", "Οχήματα από δεξιά", "Οχήματα από αριστερά", "Οχήματα που προσεγγίζουν πρώτα", "Οχήματα με μεγαλύτερο μέγεθος", 1, "θεωρητική"),
                ("Ποια είναι η σημασία του σήματος 'STOP';", "Περιορίστε την ταχύτητα", "Σταματήστε πλήρως και συνεχίστε όταν είναι ασφαλές", "Δώστε προτεραιότητα", "Απαγορεύεται η στροφή", 2, "θεωρητική"),
                ("Ποιο είναι το νόημα του σήματος 'Προτεραιότητα';", "Σταματήστε πλήρως", "Δώστε προτεραιότητα", "Περιορίστε την ταχύτητα", "Απαγορεύεται η προσπέραση", 2, "θεωρητική"),
                ("Πότε πρέπει να χρησιμοποιείτε τα φώτα έκτακτης ανάγκης;", "Όταν οδηγείτε σε κακή ορατότητα", "Όταν σταθμεύετε σε επικίνδυνη θέση", "Όταν αλλάζετε λωρίδα", "Όταν πλησιάζετε σε διάβαση πεζών", 2, "θεωρητική"),
                ("Ποιο είναι το νόημα του σήματος 'Απαγορεύεται η προσπέραση';", "Απαγορεύεται η είσοδος", "Απαγορεύεται η στάθμευση", "Απαγορεύεται η προσπέραση", "Υποχρεωτική στροφή αριστερά", 3, "θεωρητική"),
                ("Ποιο είναι το όριο αλκοόλ στο αίμα για νέους οδηγούς;", "0.2‰", "0.5‰", "0.8‰", "1.0‰", 1, "θεωρητική"),
                ("Πότε πρέπει να χρησιμοποιείτε τις αλυσίδες χιονιού;", "Όταν υπάρχει παγετός στο δρόμο", "Όταν υπάρχει χιόνι στο δρόμο", "Όταν οδηγείτε σε λασπωμένο δρόμο", "Όταν βρέχει καταρρακτωδώς", 2, "θεωρητική"),
                ("Ποιο είναι το νόημα του σήματος 'Υποχρεωτική πορεία';", "Υποχρεωτική πορεία ευθεία", "Υποχρεωτική πορεία αριστερά", "Υποχρεωτική πορεία δεξιά", "Υποχρεωτική πορεία προς τα πίσω", 3, "θεωρητική"),
                ("Τι πρέπει να κάνετε όταν βλέπετε το σήμα 'Διαβάσεις πεζών';", "Επιβραδύνετε και είστε έτοιμοι να σταματήσετε", "Σταματήστε πλήρως", "Αυξήστε την ταχύτητά σας", "Κορνάρετε για να ειδοποιήσετε τους πεζούς", 1, "θεωρητική"),
                ("Τι πρέπει να κάνετε όταν βλέπετε το σήμα 'Απαγορεύεται η στροφή δεξιά';", "Στροφή αριστερά", "Σταματήστε πλήρως", "Συνεχίστε ευθεία", "Στροφή δεξιά", 3, "θεωρητική"),
                ("Ποια είναι η προτεραιότητα σε έναν κυκλικό κόμβο;", "Τα οχήματα μέσα στον κυκλικό κόμβο", "Τα οχήματα που εισέρχονται στον κυκλικό κόμβο", "Τα ποδήλατα", "Οι πεζοί", 1, "θεωρητική"),
                ("Τι σημαίνει η κίτρινη γραμμή στο πεζοδρόμιο;", "Απαγορεύεται η στάθμευση", "Περιορισμένη στάθμευση", "Δωρεάν στάθμευση", "Περιοχή φόρτωσης/εκφόρτωσης", 1, "θεωρητική"),
                ("Πότε επιτρέπεται να προσπεράσετε ένα σχολικό λεωφορείο;", "Όταν είναι σταματημένο χωρίς αναμμένα φώτα", "Όταν κινείται αργά", "Ποτέ όταν είναι σταματημένο για αποβίβαση επιβατών", "Όταν ο οδηγός σας δίνει σήμα", 3, "θεωρητική"),
                ("Τι πρέπει να κάνετε όταν βλέπετε το σήμα 'Δώστε προτεραιότητα';", "Επιβραδύνετε και είστε έτοιμοι να σταματήσετε αν χρειαστεί", "Σταματήστε πλήρως", "Κορνάρετε", "Συνεχίστε χωρίς να σταματήσετε", 1, "θεωρητική"),
                ("Ποια είναι η σημασία του σήματος 'Απαγορεύεται η είσοδος';", "Επιτρέπεται η είσοδος μόνο για ποδήλατα", "Απαγορεύεται η είσοδος για όλους", "Επιτρέπεται η είσοδος για λεωφορεία μόνο", "Επιτρέπεται η είσοδος για οχήματα έκτακτης ανάγκης", 2, "θεωρητική"),
                ("Τι πρέπει να κάνετε όταν βλέπετε το σήμα 'Υποχρεωτική στροφή αριστερά';", "Στροφή δεξιά", "Στροφή αριστερά", "Συνεχίστε ευθεία", "Σταματήστε", 2, "θεωρητική"),
                ("Πότε πρέπει να σταματήσετε πλήρως το όχημά σας;", "Όταν πλησιάζετε σε διασταύρωση χωρίς σήμανση", "Όταν υπάρχει πράσινο φανάρι", "Όταν υπάρχει σήμα 'STOP'", "Όταν αλλάζετε λωρίδα", 3, "θεωρητική"),
                ("Τι πρέπει να κάνετε όταν βλέπετε το σήμα 'Διπλής κατεύθυνσης';", "Οδηγείτε στο αντίθετο ρεύμα", "Κινείστε προς τα αριστερά", "Προσέχετε την κίνηση από δύο κατευθύνσεις", "Σταματήστε πλήρως", 3, "θεωρητική"),
                ("Ποιο είναι το όριο ταχύτητας σε αυτοκινητόδρομο;", "80 χλμ/ώρα", "90 χλμ/ώρα", "100 χλμ/ώρα", "120 χλμ/ώρα", 4, "θεωρητική"),
                ("Τι πρέπει να κάνετε όταν βλέπετε το σήμα 'Ολισθηρό οδόστρωμα';", "Αυξάνετε την ταχύτητά σας", "Επιβραδύνετε και αυξάνετε την προσοχή σας", "Σταματάτε πλήρως", "Κορνάρετε για να ειδοποιήσετε άλλους οδηγούς", 2, "θεωρητική"),
                ("Ποια είναι η σημασία του σήματος 'Υποχρεωτική στροφή δεξιά';", "Στροφή αριστερά", "Στροφή δεξιά", "Συνεχίστε ευθεία", "Σταματήστε", 2, "θεωρητική"),
                ("Ποιο είναι το μέγιστο όριο αλκοόλ στο αίμα για έμπειρους οδηγούς;", "0.2‰", "0.5‰", "0.8‰", "1.0‰", 2, "θεωρητική"),
                ("Πότε πρέπει να χρησιμοποιείτε τις μεσαίες φώτα;", "Κατά τη διάρκεια της ημέρας", "Σε περιοχές με καλό φωτισμό", "Όταν υπάρχει κακή ορατότητα λόγω καιρού", "Όταν οδηγείτε σε αυτοκινητόδρομο", 3, "θεωρητική"),
                ("Τι πρέπει να κάνετε όταν βλέπετε το σήμα 'Περιορισμένη στάθμευση';", "Σταματάτε πλήρως", "Σταθμεύετε μόνο για τον καθορισμένο χρόνο", "Απαγορεύεται η στάθμευση", "Συνεχίζετε χωρίς στάθμευση", 2, "θεωρητική"),
                ("Ποια είναι η σημασία του σήματος 'Απαγορεύεται η είσοδος πεζών';", "Επιτρέπεται η είσοδος μόνο για πεζούς", "Απαγορεύεται η είσοδος για πεζούς", "Επιτρέπεται η είσοδος για ποδήλατα", "Επιτρέπεται η είσοδος για οχήματα μόνο", 2, "θεωρητική"),
                ("Τι πρέπει να κάνετε όταν βλέπετε το σήμα 'Κίνδυνος';", "Αυξάνετε την ταχύτητά σας", "Σταματάτε πλήρως", "Επιβραδύνετε και είστε έτοιμοι για ενδεχόμενο κίνδυνο", "Κορνάρετε για να ειδοποιήσετε άλλους οδηγούς", 3, "θεωρητική"),
                ("Ποια είναι η σημασία του σήματος 'Περιορισμένη ταχύτητα';", "Επιτρέπεται να ξεπεράσετε το όριο ταχύτητας", "Πρέπει να κινείστε με την καθορισμένη ταχύτητα ή λιγότερο", "Απαγορεύεται η κίνηση", "Πρέπει να σταματήσετε πλήρως", 2, "θεωρητική"),
                ("Ποια είναι η σωστή διαδικασία όταν πλησιάζεις σε σιδηροδρομική διάβαση με προειδοποιητικά φώτα αναμμένα;", "Να σταματήσεις και να ελέγξεις εάν έρχεται τρένο πριν περάσεις.", "Να επιταχύνεις για να περάσεις πριν το τρένο φτάσει.", "Να συνεχίσεις κανονικά εφόσον δεν βλέπεις τρένο.", "Να μειώσεις την ταχύτητα σου και να περάσεις αργά.", 1, "θεωρητική")

            };

            // Loop through each question and add it if it doesn't exist
            foreach (var (question, option1, option2, option3, option4, correctOption, category) in questionsToAdd)
            {
                if (!newQuestionAnswer.isQuestionExists(question))
                {
                    newQuestionAnswer.AddQuestion(question, option1, option2, option3, option4, correctOption, category);
                }
                else {

                    break;
                    //Console.WriteLine($"Checking if question exists: {question}");
                }
               
            }


        }

        //Νεος Χρηστης
        public static void  DashboardCreatNewUser()
        {
            Console.Clear();
            Utility.Consoleframe();
            Console.WriteLine("\n\r\n\r|============================================== Δημιουργία Νέου Χρήστη ==============================================|\n\r\n\r");

            //username input
            Console.WriteLine("Ονομα Νέου Χρήστη:");
            string? usernameInput = Console.ReadLine();
            username = usernameInput?.ToLower() ?? string.Empty;

            //Password input
            Console.WriteLine("Κωδικός Νέου Χρήστη:");
            string? usernameOutput = Console.ReadLine();
            password = usernameOutput?.ToLower() ?? string.Empty;

            string result = SQLConnection.CreatNewUser(username,password);

            Console.WriteLine(result);

            QuestionAnswer newQuestionAnswer = new QuestionAnswer();

            Utility.PressEnter();
            Clear();
            Console.WriteLine("\n\r\n\r|==================================================== Ερωτήσεις =====================================================|\n\r\n\r");
            GreatAndAddQuestions();
            newQuestionAnswer.PrintQuestionsAddCollectAnswers();
            Utility.PressEnter();

        }

       



    }
}
